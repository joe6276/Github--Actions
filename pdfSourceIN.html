<html><head><meta charset="UTF-8"><script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-javascript.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-yaml.min.js"></script><style>
        .article {
            position: relative;
            padding-bottom: 24px;
        }
        

        .center {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        

        .center-text {
            text-align: center;
        }
        

        .code-block {
            overflow: hidden;
            position: relative;
            padding: 0;
            border-radius: 8px;
            font-variant-ligatures: none;
            background-color: rgba(25, 25, 28, .05);
            word-break: break-all;
        }
        

        .container {
            max-width: 100%;
            overflow: hidden;
            page-break-inside: avoid;
            display: block;
        }
        

        .control {
            color: #19191c;
            font-size: 16px;
            font-weight: 670;
        }
        

        .detached {
            margin-block-start: 0;
            margin-block-end: 0;
            margin-bottom: 8px;
        }
        

        .emphasis {
            color: inherit;
            font-weight: inherit;
            font-style: italic;
        }
        

        .image {
            max-width: 100%;
            max-height: 90vh;
            width: auto;
        }
        

        .image-container {
            max-width: 100vw;
        }
        

        .image-size {
            height: auto;
        }
        

        .inline-code {
            border-radius: 4px;
            display: inline;
            padding: 2px 1px;
            font-family: JetBrains Sans,monospace;
            background: #e6e6e6;
        }
        

        .list {
            list-style-type: disc;
            padding-left: 0;
            margin-left: 15px;
        }
        

        .list-item {
            margin-top: 6px;
            margin-bottom: 6px;
            margin-left: 4px;
        }
        

        .main-title {
            padding-bottom: 24px;
            margin-top: 0;
            font-size: 40px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        

        .prism {
            page-break-inside: avoid;
        }
        
        /* PrismJS 1.29.0
https://prismjs.com/download.html#themes=prism&languages=markup+css+clike+javascript+abap+abnf+actionscript+ada+agda+al+antlr4+apacheconf+apex+apl+applescript+aql+arduino+arff+armasm+arturo+asciidoc+aspnet+asm6502+asmatmel+autohotkey+autoit+avisynth+avro-idl+awk+bash+basic+batch+bbcode+bbj+bicep+birb+bison+bnf+bqn+brainfuck+brightscript+bro+bsl+c+csharp+cpp+cfscript+chaiscript+cil+cilkc+cilkcpp+clojure+cmake+cobol+coffeescript+concurnas+csp+cooklang+coq+crystal+css-extras+csv+cue+cypher+d+dart+dataweave+dax+dhall+diff+django+dns-zone-file+docker+dot+ebnf+editorconfig+eiffel+ejs+elixir+elm+etlua+erb+erlang+excel-formula+fsharp+factor+false+firestore-security-rules+flow+fortran+ftl+gml+gap+gcode+gdscript+gedcom+gettext+gherkin+git+glsl+gn+linker-script+go+go-module+gradle+graphql+groovy+haml+handlebars+haskell+haxe+hcl+hlsl+hoon+http+hpkp+hsts+ichigojam+icon+icu-message-format+idris+ignore+inform7+ini+io+j+java+javadoc+javadoclike+javastacktrace+jexl+jolie+jq+jsdoc+js-extras+json+json5+jsonp+jsstacktrace+js-templates+julia+keepalived+keyman+kotlin+kumir+kusto+latex+latte+less+lilypond+liquid+lisp+livescript+llvm+log+lolcode+lua+magma+makefile+markdown+markup-templating+mata+matlab+maxscript+mel+mermaid+metafont+mizar+mongodb+monkey+moonscript+n1ql+n4js+nand2tetris-hdl+naniscript+nasm+neon+nevod+nginx+nim+nix+nsis+objectivec+ocaml+odin+opencl+openqasm+oz+parigp+parser+pascal+pascaligo+psl+pcaxis+peoplecode+perl+php+phpdoc+php-extras+plant-uml+plsql+powerquery+powershell+processing+prolog+promql+properties+protobuf+pug+puppet+pure+purebasic+purescript+python+qsharp+q+qml+qore+r+racket+cshtml+jsx+tsx+reason+regex+rego+renpy+rescript+rest+rip+roboconf+robotframework+ruby+rust+sas+sass+scss+scala+scheme+shell-session+smali+smalltalk+smarty+sml+solidity+solution-file+soy+sparql+splunk-spl+sqf+sql+squirrel+stan+stata+iecst+stylus+supercollider+swift+systemd+t4-templating+t4-cs+t4-vb+tap+tcl+tt2+textile+toml+tremor+turtle+twig+typescript+typoscript+unrealscript+uorazor+uri+v+vala+vbnet+velocity+verilog+vhdl+vim+visual-basic+warpscript+wasm+web-idl+wgsl+wiki+wolfram+wren+xeora+xml-doc+xojo+xquery+yaml+yang+zig&plugins=highlight-keywords */
code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre-wrap;word-spacing:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:16px;margin:0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}

        

        :root {
            width: 95%;
            max-width: 95vw;
            padding: 0 0 0 30px;
        }
        
        body {
            font-family: JetBrains Sans,serif;
        }
        
        a {
            overflow-wrap: anywhere;
            width: 100vw;
        }
        
        
        @font-face {
            font-family: JetBrains Sans;
            src: url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Light.woff2) format("woff2"), url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Light.woff) format("woff");
            font-weight: 300;
            font-style: normal;
        }

        @font-face {
            font-family: JetBrains Sans;
            src: url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Regular.woff2) format("woff2"), url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Regular.woff) format("woff");
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: JetBrains Sans;
            src: url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-SemiBold.woff2) format("woff2"), url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-SemiBold.woff) format("woff");
            font-weight: 600;
            font-style: normal;
        }
        
        
        code {
            display: inline;
            word-break: break-word;
            font-size: 15px;
            line-height: inherit;
            font-variant-ligatures: none;
            font-family: JetBrains Sans,monospace;
            white-space: pre-line;
            overflow-wrap: break-word;
        }
        
        figcaption {
            margin-top: 5px;
        }
        
        h2 {
            padding-top: 16px;
            padding-bottom: 8px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        
        h3 {
            padding-top: 8px;
            padding-bottom: 8px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        
        h4 {
            padding-top: 4px;
            padding-bottom: 8px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        
        p {
            padding: 0;
            border: 0;
            line-height: 25px;
            margin-block-start: 0;
            margin-block-end: 0;
            padding-bottom: 8px;
        }
        
        div {
            display: block;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            page-break-inside: avoid;
        }
        
        th, td {
            border: 1px solid #c4c4c4;
            padding: 10px;
            text-align: left;
            word-break: break-all;
        }
        
        .entry {
            display: grid;
            grid-template-columns: auto max-content;
            grid-template-areas: "chapter page";
            align-items: end;
            gap: 0 .25rem;
            line-height: 25px;
        }
        
        .toc-link-container{
            grid-area: chapter;
            position: relative;
            overflow: hidden;
        }
        
        .toc-link{
            text-decoration: none;
            color: black;
        }
        
        .toc-link-container::after {
            position: absolute;
            padding-left: .25ch;
            content: " . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . "
            ". . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . "
            ". . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . ";
            text-align: right;
        }
        
        .page {
            grid-area: page;
            width: 30px;
            text-align: right;
        }
        

        .topic {
            page-break-before: always;
        }
        </style></head><body><div><section class="topic"><div><article class="article"><h1 class="main-title">Table of contents</h1><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1457692806">GitHub Actions</a></div><div class="page">2</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#716309368">First GitHub Action</a></div><div class="page">4</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-127988283">GitHub Action Example Two</a></div><div class="page">7</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1660684226">GitHub Events</a></div><div class="page">14</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1189271558">Job Artifacts</a></div><div class="page">17</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#2060757094">Environment Variables &amp; Secrets</a></div><div class="page">25</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-334969138">Control Execution Flow</a></div><div class="page">31</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1066257356">Custom Actions</a></div><div class="page">42</div></div></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1457692806">GitHub Actions</h1><section><h2 id="-1457692806#what-is-github-actions" data-toc="what-is-github-actions#GithubActions.md-what-is-github-actions">What is GitHub Actions</h2><p id="-1457692806#ndp4tk_6">GitHub Actions is a workflow automation service offered by GitHub, to automate all kinds of repository related processes and actions.</p><section><h3 id="-1457692806#repository" data-toc="repository#GithubActions.md-repository">Repository</h3><p id="-1457692806#ndp4tk_8">Is a bucket that contains the code.</p></section></section><section><h2 id="-1457692806#use-cases-for-github-actions" data-toc="use-cases-for-github-actions#GithubActions.md-use-cases-for-github-actions">Use Cases for GitHub Actions</h2><section><h3 id="-1457692806#code-deployment-ci-cd" data-toc="code-deployment-ci-cd#GithubActions.md-code-deployment-ci-cd">Code Deployment (CI/CD)</h3><ul class="list" id="-1457692806#ndp4tk_11" start="1"><li class="list-item" id="-1457692806#ndp4tk_12"><p>Automate code testing, building &amp; deployment.</p></li><li class="list-item" id="-1457692806#ndp4tk_13"><p>Combined, they group methods for automating app development and deployment.</p></li><li class="list-item" id="-1457692806#ndp4tk_14"><p>Code changes are automatically built, tested and merged with existing code (CI)</p></li><li class="list-item" id="-1457692806#ndp4tk_15"><p>After integration, new app or package versions are published automatically.</p></li></ul></section><section><h3 id="-1457692806#code-repository-management" data-toc="code-repository-management#GithubActions.md-code-repository-management">Code &amp; Repository Management</h3><ul class="list" id="-1457692806#ndp4tk_16" start="1"><li class="list-item" id="-1457692806#ndp4tk_17"><p>Automate Code Reviews, issues management</p></li></ul></section></section><section><h2 id="-1457692806#github-actions-key-element" data-toc="github-actions-key-element#GithubActions.md-github-actions-key-element">GitHub Actions Key Element</h2><p id="-1457692806#ndp4tk_18">There are three main key elements in GitHub:</p><ul class="list" id="-1457692806#ndp4tk_19" start="1"><li class="list-item" id="-1457692806#ndp4tk_23"><p>Workflows</p></li><li class="list-item" id="-1457692806#ndp4tk_24"><p>Jobs</p></li><li class="list-item" id="-1457692806#ndp4tk_25"><p>Steps</p></li></ul><section><h3 id="-1457692806#workflows" data-toc="workflows#GithubActions.md-workflows">Workflows</h3><ul class="list" id="-1457692806#ndp4tk_26" start="1"><li class="list-item" id="-1457692806#ndp4tk_27"><p>Workflows are attached to a GitHub repository</p></li><li class="list-item" id="-1457692806#ndp4tk_28"><p>They Contain one or more jobs</p></li><li class="list-item" id="-1457692806#ndp4tk_29"><p>They are triggered upon Events</p></li></ul></section><section><h3 id="-1457692806#jobs" data-toc="jobs#GithubActions.md-jobs">Jobs</h3><ul class="list" id="-1457692806#ndp4tk_30" start="1"><li class="list-item" id="-1457692806#ndp4tk_31"><p>Jobs define a runner( execution environment)</p></li><li class="list-item" id="-1457692806#ndp4tk_32"><p>Contain one or more steps</p></li><li class="list-item" id="-1457692806#ndp4tk_33"><p>Run in parallel( default ) or sequential.</p></li><li class="list-item" id="-1457692806#ndp4tk_34"><p>Can be conditional</p></li></ul></section><section><h3 id="-1457692806#steps" data-toc="steps#GithubActions.md-steps">Steps</h3><ul class="list" id="-1457692806#ndp4tk_35" start="1"><li class="list-item" id="-1457692806#ndp4tk_36"><p>Execute a shell script or an action.</p></li><li class="list-item" id="-1457692806#ndp4tk_37"><p>Can use custom or third party actions</p></li><li class="list-item" id="-1457692806#ndp4tk_38"><p>Steps are executed in order</p></li><li class="list-item" id="-1457692806#ndp4tk_39"><p>Can be conditional</p></li></ul></section></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="716309368">First GitHub Action</h1><p id="716309368#rpcii2_3">To create a GitHub Action, Let's first Create a repository. <div class="container"><figure class="image-container"><img class="center image image-size" id="716309368#rpcii2_10" alt="Create Repository" title="Create Repository" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image.png" width="1432" height="890"><figcaption class="center-text">Create Repository</figcaption></figure></div></p><p id="716309368#rpcii2_4">Then click on the Actions tab&gt; then configure.</p><div class="container"><figure class="image-container"><img class="center image image-size" id="716309368#rpcii2_5" alt="Action" title="Action" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_1.png" width="1812" height="792"><figcaption class="center-text">Action</figcaption></figure></div><p id="716309368#rpcii2_6">Now delete the steps on the .yml file and paste the following:</p><div class="detached code-block" id="716309368#rpcii2_7"><pre><code class="language-yaml">name: First Action
# Above is the name of the workflow
on: workflow_dispatch
# This states the event that will trigger the workflow
# in this case &quot;workflow_dispatch&quot; means it will be manually triggered.
jobs:
  ## Now list the job to be executed 
  first-job:
    # Give a name (depend on you)
    runs-on: ubuntu-latest
    # This is the virtual machine that will run the workflow
    steps:
    # Now the steps that will be taken 
      - name: First hello World
        run: echo &quot; Hello World &quot;
        # Here we give a name, to uniquely identify the step 
        # Then we use run to run a shell Command
      - name: Say GoodBye
        run: echo &quot; GoodBye!&quot;
        # Another step</code></pre></div><p id="716309368#rpcii2_8">Now commit the changes.</p><section><h2 id="716309368#run-the-workflow" data-toc="run-the-workflow#GA_First-Action.md-run-the-workflow">Run the workflow</h2><p id="716309368#rpcii2_11">Under actions &gt; All Workflows You will find the 'First Action' work flow: <div class="container"><figure class="image-container"><img class="center image image-size" id="716309368#rpcii2_13" alt="First Workflow" title="First Workflow" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_2.png" width="1897" height="702"><figcaption class="center-text">First Workflow</figcaption></figure></div></p><p id="716309368#rpcii2_12">Click on run workflow. <div class="container"><figure class="image-container"><img class="center image image-size" id="716309368#rpcii2_14" alt="Run Workflow" title="Run Workflow" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_3.png" width="1864" height="875"><figcaption class="center-text">Run Workflow</figcaption></figure></div></p></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-127988283">GitHub Action Example Two</h1><p id="-127988283#-75gt5p_3">Find the project Here: https://github.com/Teach2Give-Dotnet-Training/GA_second_Action This is a simple React App with some test files, the goal will be to write an action that can run the test files.</p><div class="detached code-block" id="-127988283#-75gt5p_4"><pre><code class="language-yaml">name: Example two
on: push
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Get the Code from the repository
        uses: actions/checkout@v4

      - name: Install NodeJS
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Dependencies
        run: npm ci

      - name: Run Tests
        run: npm run test</code></pre></div><p id="-127988283#-75gt5p_5">We will give it a name. Then run the program whenever we push to the repository.</p><section><h2 id="-127988283#more-on-events" data-toc="more-on-events#GA_Second_Workflow.md-more-on-events">More on Events</h2><p id="-127988283#-75gt5p_11"><div class="container"><figure class="image-container"><img class="center image image-size" id="-127988283#-75gt5p_12" alt="Events" title="Events" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_4.png" width="1638" height="835"><figcaption class="center-text">Events</figcaption></figure></div> There are so many events that can trigger a workflow. We have repository related events and other events that don't depend on repositories. Events also have variations. To get to know events and variations more you can check at this link (<a href="https://docs.github.com/en/actions/writing-workflows/choosing-when-your-workflow-runs/events-that-trigger-workflows">https://docs.github.com/en/actions/writing-workflows/choosing-when-your-workflow-runs/events-that-trigger-workflows</a>)</p></section><section><h2 id="-127988283#action" data-toc="action#GA_Second_Workflow.md-action">Action</h2><ul class="list" id="-127988283#-75gt5p_14" start="1"><li class="list-item" id="-127988283#-75gt5p_16"><p>A (custom) application that performs a (typically complex) frequently repeated task</p></li><li class="list-item" id="-127988283#-75gt5p_17"><p>You can build your own actions, but you can also use official or community actions.</p></li></ul><p id="-127988283#-75gt5p_15">An alternative to an action is Command</p></section><section><h2 id="-127988283#command-run" data-toc="command-run#GA_Second_Workflow.md-command-run">Command(&quot;run&quot;)</h2><ul class="list" id="-127988283#-75gt5p_18" start="1"><li class="list-item" id="-127988283#-75gt5p_36"><p>A (typically simple) shell command that you define.</p></li></ul><div class="detached code-block" id="-127988283#-75gt5p_19"><pre><code class="language-yaml">steps:
  - name: Get the Code from the repository
    uses: actions/checkout@v4</code></pre></div><p id="-127988283#-75gt5p_20">The ubuntu-latest runner by default does not have the code, the above step will make sure that the code is downloaded from the repository to the virtual machine.</p><div class="detached code-block" id="-127988283#-75gt5p_21"><pre><code class="language-yaml">- name: Install NodeJS
  uses: actions/setup-node@v4
  with:
     node-version: '20'</code></pre></div><p id="-127988283#-75gt5p_22">The above step is optional this is because the runner we are using has Node JS installed already. Here is a List of software installed in it: Link (<a href="https://github.com/actions/runner-images/blob/main/images/ubuntu/Ubuntu2204-Readme.md">https://github.com/actions/runner-images/blob/main/images/ubuntu/Ubuntu2204-Readme.md</a>)</p><p id="-127988283#-75gt5p_23">In case you want to use a different version of Node JS you can now use this action and give a different variation.</p><div class="detached code-block" id="-127988283#-75gt5p_24"><pre><code class="language-yaml">- name: Install Dependencies
  run: npm ci</code></pre></div><p id="-127988283#-75gt5p_25">This step will make sure that the runner installs the right dependencies needed to run the project.</p><div class="detached code-block" id="-127988283#-75gt5p_26"><pre><code class="language-yaml">- name: Run Tests
  run: npm run test</code></pre></div><p id="-127988283#-75gt5p_27">Now run the command to run the tests. This is also defined in package.json file.</p><p id="-127988283#-75gt5p_28">Now push the changes and check your action (Its triggered by a push event)</p><div class="container"><figure class="image-container"><img class="center image image-size" id="-127988283#-75gt5p_29" alt="Success" title="Success" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_5.png" width="1797" height="894"><figcaption class="center-text">Success</figcaption></figure></div><p id="-127988283#-75gt5p_30">Now let's cause a Bug im the MainContent.test.jsx by negating the test.</p><div class="detached code-block" id="-127988283#-75gt5p_31"><pre><code class="language-javascript">describe('MainContent', () =&gt; {
  it('should render a button', () =&gt; {
    render(&lt;MainContent /&gt;);

    expect(screen.getByRole('button')).not.toBeInTheDocument();
  });</code></pre></div><p id="-127988283#-75gt5p_32">Now push the changes and check the Workflow. Now the workflow Fails: <div class="container"><figure class="image-container"><img class="center image image-size" id="-127988283#-75gt5p_38" alt="Failure" title="Failure" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_6.png" width="1840" height="907"><figcaption class="center-text">Failure</figcaption></figure></div></p><p id="-127988283#-75gt5p_33">Now let's correct the above and add another step then push. The below step will mimic deploying an application</p><div class="detached code-block" id="-127988283#-75gt5p_34"><pre><code class="language-yaml">name: Example two 
on: push
jobs: 
    test:
        runs-on: ubuntu-latest
        steps:
            - name: Get the Code from the repository
              uses: actions/checkout@v4

            - name: Install NodeJS
              uses: actions/setup-node@v4
              with:
                node-version: '20'

            - name: Install Dependencies
              run: npm ci
              
            - name: Run Tests
              run: npm run test
    deploy:
        runs-on: ubuntu-latest
        steps:
            - name: Get the Code from the repository
              uses: actions/checkout@v4

            - name: Install NodeJS
              uses: actions/setup-node@v4
              with:
                node-version: '20'

            - name: Install Dependencies
              run: npm ci
              
            - name: Build Projects
              run: npm run build
            
            - name: Deploy Project
              run: echo &quot; Deploying Project...&quot;</code></pre></div><p id="-127988283#-75gt5p_35">Now both steps are successful, but they run in parallel not sequential. <div class="container"><figure class="image-container"><img class="center image image-size" id="-127988283#-75gt5p_39" alt="Steps in Parallel" title="Steps in Parallel" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_7.png" width="1848" height="655"><figcaption class="center-text">Steps in Parallel</figcaption></figure></div></p></section><section><h2 id="-127988283#needs" data-toc="needs#GA_Second_Workflow.md-needs">needs</h2><p id="-127988283#-75gt5p_40">To make this sequential, in the deploy code add:</p><div class="detached code-block" id="-127988283#-75gt5p_41"><pre><code class="language-yaml">deploy:
   needs: test</code></pre></div><div class="container"><figure class="image-container"><img class="center image image-size" id="-127988283#-75gt5p_42" alt="sequential" title="sequential" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_8.png" width="1920" height="721"><figcaption class="center-text">sequential</figcaption></figure></div></section><section><h2 id="-127988283#multi-events" data-toc="multi-events#GA_Second_Workflow.md-multi-events">Multi-Events</h2><p id="-127988283#-75gt5p_43">To trigger workflow based on multiple events</p><div class="detached code-block" id="-127988283#-75gt5p_44"><pre><code class="language-yaml">on: [push, workflow_dispatch]</code></pre></div></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1660684226">GitHub Events</h1><section><h2 id="-1660684226#event-activity-types-and-filters" data-toc="event-activity-types-and-filters#GA_Events.md-event-activity-types-and-filters">Event Activity Types and Filters</h2><p id="-1660684226#-akyl24_5">some events have Activity Types, others have filters.</p><section><h3 id="-1660684226#activity-types" data-toc="activity-types#GA_Events.md-activity-types">Activity Types</h3><p id="-1660684226#-akyl24_8">More detailed control over when a workflow will be triggered. E.g., pull_request Event Activities include:</p><ul class="list" id="-1660684226#-akyl24_9" start="1"><li class="list-item" id="-1660684226#-akyl24_14"><p>opened</p></li><li class="list-item" id="-1660684226#-akyl24_15"><p>closed</p></li><li class="list-item" id="-1660684226#-akyl24_16"><p>edited</p></li></ul><div class="detached code-block" id="-1660684226#-akyl24_10"><pre><code class="language-yaml">name: Events Demo 1
on: 
  pull_request:
    types: [opened, closed]
  workflow_dispatch:
    
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Output event data
        run: echo &quot;${{ toJSON(github.event) }}&quot;
      - name: Get code
        uses: actions/checkout@v3
      - name: Install dependencies
        run: npm ci
      - name: Test code
        run: npm run test
      - name: Build code
        run: npm run build
      - name: Deploy project
        run: echo &quot;Deploying...&quot;</code></pre></div><div class="detached code-block" id="-1660684226#-akyl24_11"><pre><code class="language-yaml">on: 
  pull_request:
    types: [opened, closed]
  workflow_dispatch:</code></pre></div><p id="-1660684226#-akyl24_12">This part will make sure that when a pull request is opened or closed, the workflow will be triggered. The workflow can also be triggered manually using the workflow_dispatch( note that you have to add the semicolon at the end)</p><p id="-1660684226#-akyl24_13">Most events with variation have defaults in case there is no type specified. E.g., for pull-request, the event's activity type is opened, synchronize, or reopened.</p></section><section><h3 id="-1660684226#filters" data-toc="filters#GA_Events.md-filters">Filters</h3><p id="-1660684226#-akyl24_17">More detailed control over when a workflow will be triggered. E.g., push Event filter based on target branch.</p><div class="detached code-block" id="-1660684226#-akyl24_18"><pre><code class="language-yaml">push:
  branches:
    - master
  paths-ignore:
    - &quot;.github/workflows/*&quot;</code></pre></div><p id="-1660684226#-akyl24_19">The above actions will filter any push that targets the &ldquo;master&rdquo; branch. Any change made to any .yml file located in the .github&gt;workflows directory.</p></section></section><section><h2 id="-1660684226#cancelling-and-skipping-workflow" data-toc="cancelling-and-skipping-workflow#GA_Events.md-cancelling-and-skipping-workflow">Cancelling and Skipping Workflow</h2><section><h3 id="-1660684226#cancelling" data-toc="cancelling#GA_Events.md-cancelling">Cancelling</h3><ul class="list" id="-1660684226#-akyl24_22" start="1"><li class="list-item" id="-1660684226#-akyl24_23"><p>Workflows get cancelled automatically when jobs fail</p></li><li class="list-item" id="-1660684226#-akyl24_24"><p>You can manually cancel workflows</p></li></ul></section><section><h3 id="-1660684226#skipping-a-workflow" data-toc="skipping-a-workflow#GA_Events.md-skipping-a-workflow">Skipping a Workflow</h3><p id="-1660684226#-akyl24_25">You can Skip via [Skip ci] etc. in the commit message. If the command is part of your commit message, the Workflow won't be executed.</p></section></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1189271558">Job Artifacts</h1><p id="-1189271558#l8jqoe_3">Job artifacts are the assets/ output generated by a job. <div class="container"><figure class="image-container"><img class="center image image-size" id="-1189271558#l8jqoe_12" alt="Build Job" title="Build Job" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_11.png" width="1437" height="832"><figcaption class="center-text">Build Job</figcaption></figure></div></p><p id="-1189271558#l8jqoe_4">Starting Workflow:</p><div class="detached code-block" id="-1189271558#l8jqoe_5"><pre><code class="language-yaml">name: Deploy website
on:
  push:
    branches:
      - master

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Get code
        uses: actions/checkout@v3
      - name: Install dependencies
        run: npm ci
      - name: Lint code
        run: npm run lint
      - name: Test code
        run: npm run test

  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Get code
        uses: actions/checkout@v3
      - name: Install dependencies
        run: npm ci
      - name: Build website
        run: npm run build

  deploy:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Deploy
        run: echo &quot;Deploying...&quot;</code></pre></div><p id="-1189271558#l8jqoe_6">The above has three jobs a test, build and deploy. But let's focus on the build job because when the <span class="emphasis" id="-1189271558#l8jqoe_13">npm run build</span> command is executed, it produces a dist file which id the file that is uploaded to a web server.</p><p id="-1189271558#l8jqoe_7">The problem is when we execute the script as it is right now, when the runner is done, it will shut down, and we will lose the files generated by the job.</p><p id="-1189271558#l8jqoe_8">So let's modify this, on the Build steps let's modify the code.</p><div class="detached code-block" id="-1189271558#l8jqoe_9"><pre><code class="language-yaml">build:
  needs: test
  runs-on: ubuntu-latest
  steps:
    - name: Get code
      uses: actions/checkout@v3
    - name: Install dependencies
      run: npm ci
    - name: Build website
      run: npm run build
    - name: Upload Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: dist-files
        path: dist</code></pre></div><section><h2 id="-1189271558#explanation" data-toc="explanation#GA_Job_Artifacts.md-explanation">Explanation</h2><div class="detached code-block" id="-1189271558#l8jqoe_14"><pre><code class="language-yaml">- name: Upload Artifacts
  uses: actions/upload-artifact@v4</code></pre></div><p id="-1189271558#l8jqoe_15">We will give the step a name and specify that we are going to use an existing action which helps us upload the artifacts.</p><div class="detached code-block" id="-1189271558#l8jqoe_16"><pre><code class="language-yaml">with:
    name: dist-files
    path: dist</code></pre></div><p id="-1189271558#l8jqoe_17">we will give it a name, in this case its <span class="emphasis" id="-1189271558#l8jqoe_24">dist-files</span>, and we will specify the path the files will be uploaded from <span class="emphasis" id="-1189271558#l8jqoe_25">dist</span>.</p><p id="-1189271558#l8jqoe_18">and now in your workflow, you should be able to see and download the files: <div class="container"><figure class="image-container"><img class="center image image-size" id="-1189271558#l8jqoe_26" alt="Artifacts" title="Artifacts" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_12.png" width="1564" height="729"><figcaption class="center-text">Artifacts</figcaption></figure></div></p><p id="-1189271558#l8jqoe_19">But we need to use the files in the deployment job. The files produced by the build process will not persist to the deployment job because they are on different runners even though they use the same runner definition. To get the artifacts, we need to download them in the deployment step. Let's modify the deployment job</p><div class="detached code-block" id="-1189271558#l8jqoe_20"><pre><code class="language-yaml">deploy:
  needs: build
  runs-on: ubuntu-latest
  steps:
    - name: Download build Artifacts
      uses: actions/download-artifact@v4
      with:
        name: dist-files
    - name: Output content
      run: ls    
    - name: Deploy
      run: echo &quot;Deploying...&quot;</code></pre></div><p id="-1189271558#l8jqoe_21">We will add the download artifact action and specify the names of the files to be downloaded, in this case its <span class="emphasis" id="-1189271558#l8jqoe_28">dist-files</span> which is the same name we used in the build step.</p><p id="-1189271558#l8jqoe_22">The action here will download and unzip the files: And we can now use the 'ls' step to list the contents.</p><p id="-1189271558#l8jqoe_23">Now we can see the output right here: <div class="container"><figure class="image-container"><img class="center image image-size" id="-1189271558#l8jqoe_29" alt="Download content" title="Download content" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_13.png" width="1435" height="454"><figcaption class="center-text">Download content</figcaption></figure></div></p></section><section><h2 id="-1189271558#dependencies-caching" data-toc="dependencies-caching#GA_Job_Artifacts.md-dependencies-caching">Dependencies Caching</h2><p id="-1189271558#l8jqoe_30"><div class="container"><figure class="image-container"><img class="center image image-size" id="-1189271558#l8jqoe_38" alt="Step Time" title="Step Time" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_14.png" width="1518" height="375"><figcaption class="center-text">Step Time</figcaption></figure></div> If we take a look at the build step, we will notice that the step that takes more time is the dependency installation step. Also, we will notice that we have repeated the step in both test and build job.</p><p id="-1189271558#l8jqoe_31">We can save some time if we cache the dependencies and reuse then in the build step. <div class="container"><figure class="image-container"><img class="center image image-size" id="-1189271558#l8jqoe_39" alt="Cache" title="Cache" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_15.png" width="1641" height="826"><figcaption class="center-text">Cache</figcaption></figure></div></p><p id="-1189271558#l8jqoe_32">GitHub Action has an action that will help us cache the dependencies</p><div class="detached code-block" id="-1189271558#l8jqoe_33"><pre><code class="language-yaml">- name: Cache Dependencies
  uses: actions/cache@v4
  with:
    path: ~/.npm
    key: deps-node-modules- ${{hashFiles('**/package-lock.json')}}</code></pre></div><p id="-1189271558#l8jqoe_34">This will now cache the dependencies and will only run <span class="emphasis" id="-1189271558#l8jqoe_40">npm ci</span> if the package.lock.json file has changed so that means we will be able to use cache for every step provided the package-lock.json file has not changed.</p><p id="-1189271558#l8jqoe_35">Now the workflow file will look like:</p><div class="detached code-block" id="-1189271558#l8jqoe_36"><pre><code class="language-yaml">jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Get code
        uses: actions/checkout@v4
      - name: Cache Dependencies
        uses: actions/cache@v4
        with:
          path: ~/.npm
          key: deps-node-modules- ${{hashFiles('**/package-lock.json')}}
      - name: Install dependencies
        run: npm ci
      - name: Lint code
        run: npm run lint
      - name: Test code
        run: npm run test

  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Get code
        uses: actions/checkout@v4
      - name: Cache Dependencies
        uses: actions/cache@v4
        with:
          path: ~/.npm
          key: deps-node-modules- ${{hashFiles('**/package-lock.json')}}
      - name: Install dependencies
        run: npm ci
      - name: Build website
        run: npm run build
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: dist-files
          path: dist</code></pre></div><p id="-1189271558#l8jqoe_37">Now you will notice that the Cache is used for the second Job (build). And cache will be used, hence it will be a bit faster. <div class="container"><figure class="image-container"><img class="center image image-size" id="-1189271558#l8jqoe_41" alt="Caching" title="Caching" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_16.png" width="1489" height="427"><figcaption class="center-text">Caching</figcaption></figure></div></p></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="2060757094">Environment Variables &amp; Secrets</h1><p id="2060757094#ppz1eq_3">Environment Variables are certain variables that are dynamic e.g. password to connect server to your database might depend if you are on development environment or Production environment. These two environments might have different databases, hence different passwords.</p><p id="2060757094#ppz1eq_4">Below are some JS variables set from environment variables</p><div class="detached code-block" id="2060757094#ppz1eq_5"><pre><code class="language-javascript">const clusterAddress = process.env.MONGODB_CLUSTER_ADDRESS;
const dbUser = process.env.MONGODB_USERNAME;
const dbPassword = process.env.MONGODB_PASSWORD;
const dbName = process.env.MONGODB_DB_NAME;</code></pre></div><p id="2060757094#ppz1eq_6">You can define environment variables in different levels:</p><ul class="list" id="2060757094#ppz1eq_7" start="1"><li class="list-item" id="2060757094#ppz1eq_21"><p>Workflow level</p></li></ul><div class="detached code-block" id="2060757094#ppz1eq_8"><pre><code class="language-yaml">name: Environment Variables
on:
  push:
    branches:
      - master
env:
  MONGO_DB_NAME: githubExample</code></pre></div><ul class="list" id="2060757094#ppz1eq_9" start="1"><li class="list-item" id="2060757094#ppz1eq_22"><p>Job Level (Available for that step only)</p></li></ul><div class="detached code-block" id="2060757094#ppz1eq_10"><pre><code class="language-yaml">jobs:
  test:
    env:
      MONGODB_USERNAME: test
      MONGODB_PASSWORD: Test@123
      MONGODB_CLUSTER_ADDRESS: cluster0.15...
      PORT: 80</code></pre></div><ul class="list" id="2060757094#ppz1eq_11" start="1"><li class="list-item" id="2060757094#ppz1eq_23"><p>Step Level (Available for that step only)</p></li></ul><p id="2060757094#ppz1eq_12">To output/ use the environment variables, there are two ways:</p><div class="detached code-block" id="2060757094#ppz1eq_13"><pre><code class="language-yaml">- name: Run server
  run: npm start &amp; npx wait-on http://127.0.0.1:$PORT</code></pre></div><p id="2060757094#ppz1eq_14">or</p><div class="detached code-block" id="2060757094#ppz1eq_15"><pre><code class="language-yaml">- name: Output Environment Variables
  run: |
      echo &quot;MONGO DB UserName : ${{env.MONGODB_USERNAME}}&quot;
      echo &quot; At Port $PORT&quot;</code></pre></div><p id="2060757094#ppz1eq_16">Output:</p><div class="container"><figure class="image-container"><img class="center image image-size" id="2060757094#ppz1eq_17" alt="ENV output" title="ENV output" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_17.png" width="1369" height="129"><figcaption class="center-text">ENV output</figcaption></figure></div><p id="2060757094#ppz1eq_18">But the Environment value is still part of the workflow file, which means anyone who can access the workflow file can access the environment variables. So we need <span class="control" id="2060757094#ppz1eq_24"><span class="emphasis" id="2060757094#ppz1eq_25">Secrets</span></span></p><section><h2 id="2060757094#secrets" data-toc="secrets#GA_Environment_Variables.md-secrets">Secrets</h2><p id="2060757094#ppz1eq_26">Secrets can be stored on :</p><ul class="list" id="2060757094#ppz1eq_27" start="1"><li class="list-item" id="2060757094#ppz1eq_29"><p>Organizational Level</p></li><li class="list-item" id="2060757094#ppz1eq_30"><p>Repository Level</p></li></ul><section><h3 id="2060757094#repository-level" data-toc="repository-level#GA_Environment_Variables.md-repository-level">Repository Level</h3><p id="2060757094#ppz1eq_31">Under Settings find Secrets &amp; Variables &gt; Actions <div class="container"><figure class="image-container"><img class="center image image-size" id="2060757094#ppz1eq_46" alt="Setting" title="Setting" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_18.png" width="1261" height="718"><figcaption class="center-text">Setting</figcaption></figure></div><div class="container"><figure class="image-container"><img class="center image image-size" id="2060757094#ppz1eq_47" alt="Action" title="Action" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_19.png" width="1158" height="816"><figcaption class="center-text">Action</figcaption></figure></div></p><p id="2060757094#ppz1eq_32">Now add new repository secret: <div class="container"><figure class="image-container"><img class="center image image-size" id="2060757094#ppz1eq_48" alt="Secret" title="Secret" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_20.png" width="967" height="436"><figcaption class="center-text">Secret</figcaption></figure></div></p><p id="2060757094#ppz1eq_33">Once a secret is stored, it can never be viewed only deleted or updated.</p><div class="container"><figure class="image-container"><img class="center image image-size" id="2060757094#ppz1eq_34" alt="Secret 1g" title="Secret 1g" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_21.png" width="790" height="148"><figcaption class="center-text">Secret 1g</figcaption></figure></div><p id="2060757094#ppz1eq_35">Now, how can we access the secrets:</p><div class="detached code-block" id="2060757094#ppz1eq_36"><pre><code class="language-yaml">env:
  MONGODB_USERNAME: ${{secrets.MONGODB_USERNAME}}</code></pre></div><p id="2060757094#ppz1eq_37">And Now even when you try to output, GitHub will hide the secret. <div class="container"><figure class="image-container"><img class="center image image-size" id="2060757094#ppz1eq_49" alt="Secret Output" title="Secret Output" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_22.png" width="1501" height="94"><figcaption class="center-text">Secret Output</figcaption></figure></div></p><p id="2060757094#ppz1eq_38">The above secrets are available for the whole workflow file, hence every job. This might work well, but sometimes you want to use different databases for different Jobs e.g., you want to use a database Named &quot;Gh-Dev&quot; for development and &quot;GH-Testing&quot; for testing. This is where environments can play a role in .</p><p id="2060757094#ppz1eq_39">Now from your settings&gt; Secrets &amp; variables &gt; Actions <div class="container"><figure class="image-container"><img class="center image image-size" id="2060757094#ppz1eq_50" alt="Enviroment " title="Enviroment " src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_24.png" width="840" height="256"><figcaption class="center-text">Enviroment </figcaption></figure></div></p><p id="2060757094#ppz1eq_40">Create a new Environment: <div class="container"><figure class="image-container"><img class="center image image-size" id="2060757094#ppz1eq_51" alt="Create Environment" title="Create Environment" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_23.png" width="973" height="184"><figcaption class="center-text">Create Environment</figcaption></figure></div></p><p id="2060757094#ppz1eq_41">Then Add Secrets:</p><div class="container"><figure class="image-container"><img class="center image image-size" id="2060757094#ppz1eq_42" alt="Add Secrets " title="Add Secrets " src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_25.png" width="1239" height="672"><figcaption class="center-text">Add Secrets </figcaption></figure></div><p id="2060757094#ppz1eq_43">Now in the Workflow File</p><div class="detached code-block" id="2060757094#ppz1eq_44"><pre><code class="language-yaml">jobs:
  test:
    environment: testing
    env:
      MONGODB_USERNAME: ${{secrets.MONGODB_USERNAME}}</code></pre></div><p id="2060757094#ppz1eq_45">This Job will use the variable defined in the 'testing' environment, and you can now configure other environment and give different values for the environment variables.</p></section></section><section><h2 id="2060757094#summary" data-toc="summary#GA_Environment_Variables.md-summary">Summary</h2><div class="container"><figure class="image-container"><img class="center image image-size" id="2060757094#ppz1eq_52" alt="Summary" title="Summary" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_26.png" width="1795" height="763"><figcaption class="center-text">Summary</figcaption></figure></div></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-334969138">Control Execution Flow</h1><p id="-334969138#z20bgze_3">At this point, we have jobs executed in a series, and if one fails, the rest are not executed. That's the default behavior. <div class="container"><figure class="image-container"><img class="center image image-size" id="-334969138#z20bgze_11" alt="Execution" title="Execution" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_27.png" width="1849" height="880"><figcaption class="center-text">Execution</figcaption></figure></div></p><p id="-334969138#z20bgze_4">But sometimes you want to keep executing even if one previous step fails, or even trigger another step if it fails or even control your execution flow.</p><section><h2 id="-334969138#conditional-jobs-steps" data-toc="conditional-jobs-steps#GA_Control_ Execution_FLow.md-conditional-jobs-steps">Conditional Jobs &amp; steps</h2><div class="container"><figure class="image-container"><img class="center image image-size" id="-334969138#z20bgze_12" alt="Control Flow" title="Control Flow" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_28.png" width="1491" height="832"><figcaption class="center-text">Control Flow</figcaption></figure></div><div class="detached code-block" id="-334969138#z20bgze_13"><pre><code class="language-yaml">- name: Test code
  run: npm run test
  - name: Upload test report
    uses: actions/upload-artifact@v3
     with:
       name: test-report
       path: test.json</code></pre></div><p id="-334969138#z20bgze_14">For the above case, it would make sense if we upload a test report if the tests fail. So we should run the Upload test report conditionally and only if when the test fail.</p><div class="detached code-block" id="-334969138#z20bgze_15"><pre><code class="language-yaml">- name: Test code
   id: steps-test
   run: npm run test
 - name: Upload test report
   if: failure() &amp;&amp; steps.steps-test.outcome =='failure'
   uses: actions/upload-artifact@v3
   with:
     name: test-report
     path: test.json</code></pre></div><p id="-334969138#z20bgze_16">We will first start by assigning the step an ID so that we can know the outcome of the test step. On the upload test report step We execute the failure() which should return true if a previous step fails, and also the outcome of the previous step is checked. If both are true, then we allow the upload step to execute, and it will upload the necessary files.</p></section><section><h2 id="-334969138#special-condition-functions" data-toc="special-condition-functions#GA_Control_ Execution_FLow.md-special-condition-functions">Special Condition Functions</h2><div class="container"><figure class="image-container"><img class="center image image-size" id="-334969138#z20bgze_17" alt="Special Condition Function" title="Special Condition Function" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_29.png" width="1639" height="843"><figcaption class="center-text">Special Condition Function</figcaption></figure></div><p id="-334969138#z20bgze_18">Now when the tests fail, we get a report: <div class="container"><figure class="image-container"><img class="center image image-size" id="-334969138#z20bgze_19" alt="Report" title="Report" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_30.png" width="1551" height="856"><figcaption class="center-text">Report</figcaption></figure></div></p></section><section><h2 id="-334969138#condition-on-jobs" data-toc="condition-on-jobs#GA_Control_ Execution_FLow.md-condition-on-jobs">Condition on Jobs</h2><div class="detached code-block" id="-334969138#z20bgze_20"><pre><code class="language-yaml">report: 
  needs: [lint,deploy]
  runs-on: ubuntu-latest
  if: failure()
  steps:
    - name: Output Text
      run: echo &quot;Either Lint or test failed&quot;</code></pre></div><p id="-334969138#z20bgze_21">The above job will only run when the lint or deploy a j ob fails</p><p id="-334969138#z20bgze_22">Output: <div class="container"><figure class="image-container"><img class="center image image-size" id="-334969138#z20bgze_23" alt="Conditional Jobs" title="Conditional Jobs" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_31.png" width="1299" height="232"><figcaption class="center-text">Conditional Jobs</figcaption></figure></div></p></section><section><h2 id="-334969138#continue" data-toc="continue#GA_Control_ Execution_FLow.md-continue">Continue</h2><p id="-334969138#z20bgze_24">Instead of using an if statement, we can use <span class="emphasis" id="-334969138#z20bgze_28">continue-on-error</span> which is going to make sure the workflow still executes even if there is an error.</p><p id="-334969138#z20bgze_25">We can make our test a failing test then modify the workflow as follows:</p><div class="detached code-block" id="-334969138#z20bgze_26"><pre><code class="language-yaml">- name: Test code
  id: steps-test
  continue-on-error: true
  run: npm run test
- name: Upload test report
  uses: actions/upload-artifact@v3
  with:
    name: test-report
    path: test.json</code></pre></div><p id="-334969138#z20bgze_27">Output is: Even through the Test Step Fails: <div class="container"><figure class="image-container"><img class="center image image-size" id="-334969138#z20bgze_29" alt="Test Fails" title="Test Fails" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_32.png" width="1449" height="447"><figcaption class="center-text">Test Fails</figcaption></figure></div> The Workflow succeeds: <div class="container"><figure class="image-container"><img class="center image image-size" id="-334969138#z20bgze_30" alt="Workflow Success" title="Workflow Success" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_33.png" width="1276" height="277"><figcaption class="center-text">Workflow Success</figcaption></figure></div></p></section><section><h2 id="-334969138#matrix" data-toc="matrix#GA_Control_ Execution_FLow.md-matrix">Matrix</h2><p id="-334969138#z20bgze_31">Sometimes you have a workflow :</p><div class="detached code-block" id="-334969138#z20bgze_32"><pre><code class="language-yaml">name: Matrix -Demo 
on: push
jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Get Code
              uses: actions/checkout@v4
              
            - name: Install NodeJS
              uses: actions/setup-node@v4
              with:
                node-version: 14
            
            - name: Install Dependencies
              run: npm ci
            
            - name: Build Project
              run: npm run build</code></pre></div><p id="-334969138#z20bgze_33">And you want to see how the workflow would behave in different environments.E.g. How would it work on node version 18, 20 or even on different runners. You need to use a matrix in that case:</p><div class="detached code-block" id="-334969138#z20bgze_34"><pre><code class="language-yaml">name: Matrix -Demo 
on: push
jobs:
    build:
        continue-on-error: true
        strategy:
            matrix:
                node-version: [12,14,16]
                operating-system: [ubuntu-latest, windows-latest]
        runs-on: ${{matrix.operating-system}}
        steps:
            - name: Get Code
              uses: actions/checkout@v4
              
            - name: Install NodeJS
              uses: actions/setup-node@v4
              with:
                node-version: ${{matrix.node-version}}
            
            - name: Install Dependencies
              run: npm ci
            
            - name: Build Project
              run: npm run build</code></pre></div><p id="-334969138#z20bgze_35">Now in this case, we will run the job with different operating systems and also in different node versions.</p><div class="container"><figure class="image-container"><img class="center image image-size" id="-334969138#z20bgze_36" alt="matrix" title="matrix" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_34.png" width="787" height="411"><figcaption class="center-text">matrix</figcaption></figure></div><p id="-334969138#z20bgze_37">But assuming you need Node-version 18 and ubuntu-latest operating system and not Node-version 18 and Windows-latest operating system, you can use the include keyword. You can also exclude a certain combination.</p><div class="detached code-block" id="-334969138#z20bgze_38"><pre><code class="language-yaml">strategy:
          matrix:
              node-version: [12,14,16]
              operating-system: [ubuntu-latest, windows-latest]
              include:
                  - node-version: 18
                    operating-system: ubuntu-latest 
              exclude:
                  - node-version: 12
                    operating-system: windows-latest 
runs-on: ${{matrix.operating-system}}
steps:</code></pre></div></section><section><h2 id="-334969138#reusable-workflows" data-toc="reusable-workflows#GA_Control_ Execution_FLow.md-reusable-workflows">Reusable Workflows</h2><p id="-334969138#z20bgze_39">Sometimes you have workflows that others workflows can reuse, for example, lets have the deployment job in a separate file.</p><p id="-334969138#z20bgze_40">in a separate file write:</p><div class="detached code-block" id="-334969138#z20bgze_41"><pre><code class="language-yaml">name: Reusable Workflow
on: workflow_call
jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
            - name: Output information
              run: echo &quot; Deploying &amp; Uploading Site...&quot;</code></pre></div><p id="-334969138#z20bgze_42">The only thing that is different is this will be called on <span class="emphasis" id="-334969138#z20bgze_54">workflow_call</span>, so that is an event that means another workflow must call it.</p><p id="-334969138#z20bgze_43">on the target workflow write:</p><div class="detached code-block" id="-334969138#z20bgze_44"><pre><code class="language-yaml">Deploy:
      needs: build
      uses: ./.github/workflows/reusable.yaml</code></pre></div><p id="-334969138#z20bgze_45">you must give the relative path to the workflow we want to reuse.</p><p id="-334969138#z20bgze_46">Now separating the two files brings a problem. The problem is that the deploy job needs the artifacts produced by the build job. So we need to pass the file from the Main workflow to the reusable deploy job.</p><p id="-334969138#z20bgze_47">on the deploy job, we are going to accept inputs:</p><div class="detached code-block" id="-334969138#z20bgze_48"><pre><code class="language-yaml">name: Reusable Workflow
on: 
    workflow_call:
        inputs:
            artifacts:
                description: The name of the deployable artifact files
                required: false
                default: dist
                type: string
jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
            - name: Get Code
              uses: actions/download-artifact@v4
              with:
                name: ${{inputs.artifacts}}

            - name: List Files
              run: ls

            - name: Output information
              run: echo &quot; Deploying &amp; Uploading Site...&quot;</code></pre></div><p id="-334969138#z20bgze_49">Here we will define an input that has a description, a required boolean to show if the value must be passed, a default value for any default you would like to pass in case the required is false and the type of the value you will pass.</p><p id="-334969138#z20bgze_50">On the other workflow we need to pass the artifacts:</p><div class="detached code-block" id="-334969138#z20bgze_51"><pre><code class="language-yaml">Deploy:
      needs: build
      uses: ./.github/workflows/reusable.yaml
      with: 
        artifacts: dist-files</code></pre></div><p id="-334969138#z20bgze_52">besides inputs you can also pass secrets. and also outputs.</p><section><h3 id="-334969138#outputs" data-toc="outputs#GA_Control_ Execution_FLow.md-outputs">Outputs</h3><p id="-334969138#z20bgze_55">Below is the reusable workflow:</p><div class="detached code-block" id="-334969138#z20bgze_56"><pre><code class="language-yaml">name: Reusable Workflow
on: 
    workflow_call:
        inputs:
            artifacts:
                description: The name of the deployable artifact files
                required: false
                default: dist
                type: string
       
        outputs:
            result:
                description: The result of the deployment operation
                value: ${{jobs.deploy.outputs.outcome}}

jobs:
    deploy:
        outputs:
            outcome: ${{steps.output-step.outputs.step-result}}
        runs-on: ubuntu-latest
        steps:
            - name: Get Code
              uses: actions/download-artifact@v4
              with:
                name: ${{inputs.artifacts}}

            - name: List Files
              run: ls

            - name: Output information
              run: echo &quot; Deploying &amp; Uploading Site...&quot;
            - name: Set Result Output
              id: output-step
              run: echo &quot;::set-output name=step-result::success&quot;</code></pre></div><div class="detached code-block" id="-334969138#z20bgze_57"><pre><code class="language-yaml">- name: Set Result Output
  id: output-step
  run: echo &quot;::set-output name=step-result::success&quot;</code></pre></div><ul class="list" id="-334969138#z20bgze_58" start="1"><li class="list-item" id="-334969138#z20bgze_61"><p>name: &quot;Set Result Output.&quot;</p></li><li class="list-item" id="-334969138#z20bgze_62"><p>id: The ID is output-step, used to reference this step&rsquo;s output. run: Sets the output variable step-result to success using echo &quot;::set-output name=step-result::success&quot;.</p></li><li class="list-item" id="-334969138#z20bgze_63"><p>outputs: Defines the output outcome for this job, which is taken from the result of the step with ID output-step.</p></li></ul><div class="detached code-block" id="-334969138#z20bgze_59"><pre><code class="language-yaml">outputs:
   outcome: ${{steps.output-step.outputs.step-result}}</code></pre></div><ul class="list" id="-334969138#z20bgze_60" start="1"><li class="list-item" id="-334969138#z20bgze_64"><p>jobs: Defines a job named deploy.</p></li><li class="list-item" id="-334969138#z20bgze_65"><p>outputs: Defines the output outcome for this job, which is taken from the result of the step with ID output-step.</p></li></ul></section></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1066257356">Custom Actions</h1><p id="-1066257356#omp92m_4">We have been using public actions so far :</p><ul class="list" id="-1066257356#omp92m_6" start="1"><li class="list-item" id="-1066257356#omp92m_138"><p>actions/checkout@v3</p></li><li class="list-item" id="-1066257356#omp92m_139"><p>actions/cache@v3</p></li><li class="list-item" id="-1066257356#omp92m_140"><p>actions/upload-artifact@v3</p></li><li class="list-item" id="-1066257356#omp92m_141"><p>actions/download-artifact@v3</p></li></ul><p id="-1066257356#omp92m_8">It's time to build custom actions now, but why?</p><section><h2 id="-1066257356#why-custom-action" data-toc="why-custom-action#GA_Custom_Actions.md-why-custom-action">Why Custom Action</h2><ul class="list" id="-1066257356#omp92m_142" start="1"><li class="list-item" id="-1066257356#omp92m_143"><p id="-1066257356#omp92m_146">Simplify workflow steps Instead of writing multiple (possibly very complex) step definitions, you can build and use a single custom action. Multiple steps can be grouped into a single custom action, which can be reused.</p></li><li class="list-item" id="-1066257356#omp92m_144"><p id="-1066257356#omp92m_147">No existing (community) action Existing, public actions might not solve the specific problem you have in your workflow. Custom actions can contain any logic you need to solve your specific workflow problems.</p></li><li class="list-item" id="-1066257356#omp92m_145"><p id="-1066257356#omp92m_148">You can publish it in the marketplace and ccontribute to the community.</p></li></ul></section><section><h2 id="-1066257356#different-types-of-custom-actions" data-toc="different-types-of-custom-actions#GA_Custom_Actions.md-different-types-of-custom-actions">Different Types of custom Actions</h2><ul class="list" id="-1066257356#omp92m_19" start="1"><li class="list-item" id="-1066257356#omp92m_149"><p>Javascript Actions</p></li><li class="list-item" id="-1066257356#omp92m_150"><p>Docker Actions</p></li><li class="list-item" id="-1066257356#omp92m_151"><p>Composite Actions</p></li></ul><section><h3 id="-1066257356#javascript-actions" data-toc="javascript-actions#GA_Custom_Actions.md-javascript-actions">Javascript Actions</h3><ul class="list" id="-1066257356#omp92m_152" start="1"><li class="list-item" id="-1066257356#omp92m_153"><p>Execute a JavaScript file</p></li><li class="list-item" id="-1066257356#omp92m_154"><p>Use JavaScript ( Node.js) + any packages of your choice.</p></li><li class="list-item" id="-1066257356#omp92m_155"><p>Pretty Straightforward (If you know JavaScript)</p></li></ul></section><section><h3 id="-1066257356#docker-actions" data-toc="docker-actions#GA_Custom_Actions.md-docker-actions">Docker Actions</h3><ul class="list" id="-1066257356#omp92m_156" start="1"><li class="list-item" id="-1066257356#omp92m_157"><p>Create a Dockerfile with your required configuration.</p></li><li class="list-item" id="-1066257356#omp92m_158"><p>Perform any tasks of your choice with any Language</p></li><li class="list-item" id="-1066257356#omp92m_159"><p>Lots of flexibility but required Docker Knowledge.</p></li></ul></section><section><h3 id="-1066257356#composite-actions" data-toc="composite-actions#GA_Custom_Actions.md-composite-actions">Composite Actions</h3><ul class="list" id="-1066257356#omp92m_26" start="1"><li class="list-item" id="-1066257356#omp92m_160"><p>Combine multiple workflow steps in one single Action</p></li><li class="list-item" id="-1066257356#omp92m_161"><p>Combine run (commands) and use (Actions)</p></li><li class="list-item" id="-1066257356#omp92m_162"><p>Allows for reusing shared steps (without extra skills)</p></li></ul><p id="-1066257356#omp92m_29">Here is out starting Workflow:</p><div class="detached code-block" id="-1066257356#omp92m_31"><pre><code class="language-yaml">name: Deployment
on:
  push:
    branches:
      - master
      
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Get code
        uses: actions/checkout@v3
      - name: Cache dependencies
        id: cache
        uses: actions/cache@v3
        with:
          path: node_modules
          key: deps-node-modules-${{ hashFiles('**/package-lock.json') }}
      - name: Install dependencies
        if: steps.cache.outputs.cache-hit != 'true'
        run: npm ci
      - name: Lint code
        run: npm run lint
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Get code
        uses: actions/checkout@v3
      - name: Cache dependencies
        id: cache
        uses: actions/cache@v3
        with:
          path: node_modules
          key: deps-node-modules-${{ hashFiles('**/package-lock.json') }}
      - name: Install dependencies
        if: steps.cache.outputs.cache-hit != 'true'
        run: npm ci
      - name: Test code
        id: run-tests
        run: npm run test
      - name: Upload test report
        if: failure() &amp;&amp; steps.run-tests.outcome == 'failure'
        uses: actions/upload-artifact@v3
        with:
          name: test-report
          path: test.json
  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Get code
        uses: actions/checkout@v3
      - name: Cache dependencies
        id: cache
        uses: actions/cache@v3
        with:
          path: node_modules
          key: deps-node-modules-${{ hashFiles('**/package-lock.json') }}
      - name: Install dependencies
        if: steps.cache.outputs.cache-hit != 'true'
        run: npm ci
      - name: Build website
        run: npm run build
      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: dist-files
          path: dist
  deploy:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Get code
        uses: actions/checkout@v3
      - name: Get build artifacts
        uses: actions/download-artifact@v3
        with:
          name: dist-files
          path: ./dist
      - name: Output contents
        run: ls
      - name: Deploy site
        run: echo &quot;Deploying...&quot;</code></pre></div><p id="-1066257356#omp92m_33">if you look at the workflow file, you will notice that there are repeated steps :</p><ul class="list" id="-1066257356#omp92m_35" start="1"><li class="list-item" id="-1066257356#omp92m_50"><p>Getting the code</p></li><li class="list-item" id="-1066257356#omp92m_53"><p>Caching dependencies</p></li></ul><p id="-1066257356#omp92m_37">lets build a composite action</p><div class="detached code-block" id="-1066257356#omp92m_39"><pre><code class="language-yaml">name: 'Get  and Cache Dependencies'
description: ' Get the dependencies and Cache them'
runs:
  using: 'composite'
  steps:
    - name: Cache dependencies
      id: cache
      uses: actions/cache@v3
      with:
        path: node_modules
        key: deps-node-modules-${{ hashFiles('**/package-lock.json') }}
        
    - name: Install dependencies
      if: steps.cache.outputs.cache-hit != 'true'
      run: npm ci
      shell: bash</code></pre></div><ul class="list" id="-1066257356#omp92m_41" start="1"><li class="list-item" id="-1066257356#omp92m_54"><p>Here, we will give it a name and a description first</p></li><li class="list-item" id="-1066257356#omp92m_55"><p><span class="control" id="-1066257356#omp92m_62"><span class="inline-code" id="-1066257356#omp92m_63">runs</span>:</span> Defines how the action will be executed.</p></li><li class="list-item" id="-1066257356#omp92m_59"><p>This particular action uses a composite type, meaning it contains multiple steps within.</p></li><li class="list-item" id="-1066257356#omp92m_61"><p>For any step that uses the run command, we must pass the <span class="emphasis" id="-1066257356#omp92m_163">shell: bash</span></p></li></ul><p id="-1066257356#omp92m_43">to use it, we need to specify a pathe of where the action file is located:</p><div class="detached code-block" id="-1066257356#omp92m_45"><pre><code class="language-yaml">- name: Load &amp; Cache Dependencies
  uses: ./.github/actions/cache</code></pre></div><p id="-1066257356#omp92m_46">And now the workflow runs well, and it's streamlined. <div class="container"><figure class="image-container"><img class="center image image-size" id="-1066257356#omp92m_164" alt="Workflow Output" title="Workflow Output" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_35.png" width="1849" height="792"><figcaption class="center-text">Workflow Output</figcaption></figure></div></p><p id="-1066257356#omp92m_48">Composite actions can also have inputs and outputs too.</p></section></section><section><h2 id="-1066257356#javascript-action" data-toc="javascript-action#GA_Custom_Actions.md-javascript-action">JavaScript Action</h2><p id="-1066257356#omp92m_64">Let create an S3 bucket <div class="container"><figure class="image-container"><img class="center image image-size" id="-1066257356#omp92m_165" alt="S3 Creation" title="S3 Creation" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_36.png" width="1386" height="826"><figcaption class="center-text">S3 Creation</figcaption></figure></div><div class="container"><figure class="image-container"><img class="center image image-size" id="-1066257356#omp92m_166" alt="S3 Access" title="S3 Access" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_37.png" width="1404" height="706"><figcaption class="center-text">S3 Access</figcaption></figure></div></p><p id="-1066257356#omp92m_65">Leave the rest as default and create it.</p><section><h3 id="-1066257356#static-website-hosting" data-toc="static-website-hosting#GA_Custom_Actions.md-static-website-hosting">Static website hosting</h3><p id="-1066257356#omp92m_167">Go to the bucket&gt; then properties &gt; Static website hosting&gt; Edit</p><p id="-1066257356#omp92m_168">Enable website hosting and also make sure the index.html is filled in the index document then save the changes. <div class="container"><figure class="image-container"><img class="center image image-size" id="-1066257356#omp92m_169" alt="Static Website Hosting" title="Static Website Hosting" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_40.png" width="1713" height="808"><figcaption class="center-text">Static Website Hosting</figcaption></figure></div></p></section><section><h3 id="-1066257356#permission" data-toc="permission#GA_Custom_Actions.md-permission">Permission</h3><p id="-1066257356#omp92m_68">We need permission to be able to protect the bucket.</p><div class="detached code-block" id="-1066257356#omp92m_69"><pre><code class="language-yaml">{
	&quot;Version&quot;: &quot;2012-10-17&quot;,
	&quot;Statement&quot;: [
		{
			&quot;Sid&quot;: &quot;Statement1&quot;,
			&quot;Principal&quot;: &quot;*&quot;,
			&quot;Effect&quot;: &quot;Allow&quot;,
			&quot;Action&quot;: [
				&quot;s3:GetObject&quot;
			],
			&quot;Resource&quot;: [
				&quot;arn:aws:s3:::gha-pipeline/*&quot;
			]
		}
	]
}</code></pre></div><p id="-1066257356#omp92m_70">While in AWS Create Access Key:</p><p id="-1066257356#omp92m_71"><div class="container"><figure class="image-container"><img class="center image image-size" id="-1066257356#omp92m_170" alt="Access Key" title="Access Key" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_38.png" width="1833" height="784"><figcaption class="center-text">Access Key</figcaption></figure></div><div class="container"><figure class="image-container"><img class="center image image-size" id="-1066257356#omp92m_171" alt="Output Security Credentials" title="Output Security Credentials" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_39.png" width="1630" height="685"><figcaption class="center-text">Output Security Credentials</figcaption></figure></div></p><p id="-1066257356#omp92m_72">Now, back to my Workflow:</p><div class="detached code-block" id="-1066257356#omp92m_73"><pre><code class="language-yaml">name: 'Get  and Cache Dependencies'
description: ' Get the dependencies and Cache them'
inputs:
  bucket:
    description: ' The S3 Bucket Name'
    required: true

  bucket-region:
    description: ' The S3 Bucket region'
    required: true

  dist-folder:
    description: ' The folder containing artifacts'
    required: true
  
outputs:
  website-url:
    description: The Website URL

runs:
  using: 'node20'
  main: 'main.js'</code></pre></div><p id="-1066257356#omp92m_74">The run part now will use Node.js version 20, and we will have to create a <span class="emphasis" id="-1066257356#omp92m_172">main.js</span> file for the JavaScript code</p><p id="-1066257356#omp92m_78">We will have some inputs that must be passed:</p><ul class="list" id="-1066257356#omp92m_84" start="1"><li class="list-item" id="-1066257356#omp92m_173"><p>bucket</p></li><li class="list-item" id="-1066257356#omp92m_174"><p>bucket region</p></li><li class="list-item" id="-1066257356#omp92m_175"><p>dist folder</p></li></ul><p id="-1066257356#omp92m_87">And also output the website URL once it's uploaded to the S3 bucket.</p><p id="-1066257356#omp92m_90">Let's look at the main.js:</p><p id="-1066257356#omp92m_92">First, let's install some packages we need :</p><p id="-1066257356#omp92m_93">Inside the .github&gt; actions&gt; deploy-s3-javascript</p><p id="-1066257356#omp92m_95">run</p><div class="detached code-block" id="-1066257356#omp92m_97"><pre><code class="language-javascript">npm init -y</code></pre></div><p id="-1066257356#omp92m_99">then:</p><div class="detached code-block" id="-1066257356#omp92m_101"><pre><code class="language-javascript">npm install @actions/core @actions/github @actions/exec</code></pre></div><p id="-1066257356#omp92m_103">and now the code :</p><div class="detached code-block" id="-1066257356#omp92m_105"><pre><code class="language-javascript">const core = require('@actions/core')
const github = require('@actions/github')
const exec= require('@actions/exec')
async function run(){

    const bucket= core.getInput('bucket', {required:true})
    const bucketRegion= core.getInput('bucket-region', {required:true})
    const distFolder= core.getInput('dist-folder', {required:true})


    const s3Uri= `s3://${bucket}`
    exec.exec (` aws s3 sync ${distFolder} ${s3Uri} --region ${bucketRegion}`)

    const websiteUrl= `http://${bucket}.s3-website-${bucketRegion}.amazonaws.com`
    core.setOutput('website-url', websiteUrl)
}

run()</code></pre></div><div class="detached code-block" id="-1066257356#omp92m_107"><pre><code class="language-javascript">const core = require('@actions/core')
const github = require('@actions/github')
const exec= require('@actions/exec')</code></pre></div><p id="-1066257356#omp92m_109">Here we will require the packages we have just installed.</p><div class="detached code-block" id="-1066257356#omp92m_111"><pre><code class="language-javascript">const bucket= core.getInput('bucket', {required:true})
const bucketRegion= core.getInput('bucket-region', {required:true})
const distFolder= core.getInput('dist-folder', {required:true})</code></pre></div><p id="-1066257356#omp92m_113">then now we will read the inputs that will be passed and save then to the variables defined.</p><div class="detached code-block" id="-1066257356#omp92m_115"><pre><code class="language-javascript">const s3Uri= `s3://${bucket}`
exec.exec (` aws s3 sync ${distFolder} ${s3Uri} --region ${bucketRegion}`)</code></pre></div><p id="-1066257356#omp92m_117">Now let's construct the url then we will sync the dist folder received as input with the S3 bucket.</p><p id="-1066257356#omp92m_118">Then Lastly, we will construct the website URl too:</p><div class="detached code-block" id="-1066257356#omp92m_121"><pre><code class="language-javascript">const websiteUrl= `http://${bucket}.s3-website-${bucketRegion}.amazonaws.com`
core.setOutput('website-url', websiteUrl)</code></pre></div><p id="-1066257356#omp92m_123">then this will set the output.</p><p id="-1066257356#omp92m_125">Now in the Main Workflow:</p><div class="detached code-block" id="-1066257356#omp92m_127"><pre><code class="language-yaml">deploy:
  needs:  build
  runs-on: ubuntu-latest
  steps:
    - name: Get code
      uses: actions/checkout@v3

    - name: Get Build artifacts
      uses:  actions/download-artifact@v3
      with:
        name: dist-files
        path: ./dist
    - name: Deploy site
      id: deploy
      uses: ./.github/actions/deploy-s3-javascript
      env:
        AWS_ACCESS_KEY_ID: ${{secrets.AWS_ACCESS_KEY_ID}}
        AWS_SECRET_ACCESS_KEY: ${{secrets.AWS_SECRET_ACCESS_KEY}}
      with:
        bucket: gha-pipeline
        dist-folder: ./dist

    - name: Output information
      run: |
        echo &quot; Live URL ${{steps.deploy.outputs.website-url}}&quot;</code></pre></div><p id="-1066257356#omp92m_129">We will first get the code, then download the uploaded artifacts (from the build job), and now we will use the custom actions.</p><p id="-1066257356#omp92m_131">As part of the environment variables, we need to pass the access key ID and Access Secret Key for AWS authentication.</p><p id="-1066257356#omp92m_133">We will also pass the inputs:</p><ul class="list" id="-1066257356#omp92m_135" start="1"><li class="list-item" id="-1066257356#omp92m_176"><p>The bucket</p></li><li class="list-item" id="-1066257356#omp92m_177"><p>the Dist-folder</p></li></ul><p id="-1066257356#omp92m_137">The output the URL.</p></section></section><section><h2 id="-1066257356#outputs" data-toc="outputs#GA_Custom_Actions.md-outputs">Outputs</h2><p id="-1066257356#omp92m_178"><div class="container"><figure class="image-container"><img class="center image image-size" id="-1066257356#omp92m_179" alt="Job Output" title="Job Output" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_41.png" width="1426" height="708"><figcaption class="center-text">Job Output</figcaption></figure></div><div class="container"><figure class="image-container"><img class="center image image-size" id="-1066257356#omp92m_180" alt="S3" title="S3" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_43.png" width="1597" height="445"><figcaption class="center-text">S3</figcaption></figure></div><div class="container"><figure class="image-container"><img class="center image image-size" id="-1066257356#omp92m_181" alt="Site" title="Site" src="C:/Users/JonathanNdambuki/WritersideProjects/GithubActions/Writerside/images/image_42.png" width="1705" height="631"><figcaption class="center-text">Site</figcaption></figure></div></p></section></article></div></section></div></body></html>